---
globs: *.py,*.pt,*.xml,*.cfg,*.txt
description: Flujo de trabajo con Git para el proyecto
---

#  Git Workflow - Plone 6 Migration

##  Convenciones de Commits

### Formato de Mensajes
```
tipo(scope): descripci贸n breve

Descripci贸n detallada del cambio (opcional)

- Lista de cambios espec铆ficos
- Referencias a issues/tickets
```

### Tipos de Commit
- `feat`: Nueva funcionalidad
- `fix`: Correcci贸n de bugs
- `migrate`: Cambios de migraci贸n
- `refactor`: Refactorizaci贸n de c贸digo
- `test`: A帽adir o modificar tests
- `docs`: Documentaci贸n
- `style`: Formato, espacios, etc.
- `chore`: Tareas de mantenimiento

### Ejemplos
```bash
# Migraci贸n
git commit -m "migrate(organs): normalizar infoQuorums para Plone 6"

# Bug fix
git commit -m "fix(acta): evitar recursi贸n en defaultFactory"

# Nueva funcionalidad
git commit -m "feat(sessio): a帽adir validaci贸n de quorum"

# Refactorizaci贸n
git commit -m "refactor(utils): simplificar funci贸n de parsing"
```

##  Estrategia de Branches

### Branches Principales
- `master`: C贸digo estable, listo para producci贸n
- `develop`: Integraci贸n de features, testing
- `migration`: Rama espec铆fica para migraci贸n

### Branches de Feature
- `feature/nombre-funcionalidad`
- `migrate/nombre-migracion`
- `fix/nombre-bug`
- `hotfix/urgencia`

### Ejemplo de Workflow
```bash
# Crear branch para migraci贸n
git checkout -b migrate/plone4-to-plone6

# Trabajar en cambios
git add .
git commit -m "migrate(organs): normalizar campos JSON"

# Push y crear PR
git push origin migrate/plone4-to-plone6
```

##  Flujo de Migraci贸n

### 1. Preparaci贸n
```bash
# Crear branch de migraci贸n
git checkout -b migrate/organs-plone6

# Asegurar que master est谩 actualizado
git checkout master
git pull origin master
git checkout migrate/organs-plone6
```

### 2. Desarrollo
```bash
# Hacer cambios incrementales
git add src/genweb.organs/
git commit -m "migrate(organs): actualizar schemas para Plone 6"

# Continuar con m谩s cambios
git add src/contentimport/
git commit -m "migrate(import): normalizar datos de migraci贸n"
```

### 3. Testing
```bash
# Ejecutar tests
bin/test -s genweb.organs

# Si fallan, corregir
git add .
git commit -m "fix(tests): corregir tests de migraci贸n"
```

### 4. Integraci贸n
```bash
# Merge a develop para testing
git checkout develop
git merge migrate/organs-plone6

# Testing en develop
bin/test

# Si todo OK, merge a master
git checkout master
git merge develop
```

##  Manejo de Conflictos

### Durante Merge
```bash
# Si hay conflictos
git status
# Editar archivos conflictivos
git add archivo_resuelto.py
git commit -m "resolve: conflictos de merge en migraci贸n"
```

### Durante Rebase
```bash
# Rebase interactivo
git rebase -i HEAD~3

# Si hay conflictos
git add archivo_resuelto.py
git rebase --continue
```

##  Tags y Releases

### Crear Tag
```bash
# Tag de versi贸n
git tag -a v1.0.0 -m "Release v1.0.0 - Migraci贸n Plone 6"

# Push del tag
git push origin v1.0.0
```

### Release Notes
```bash
# Generar changelog
git log --oneline v0.9.0..v1.0.0

# Crear release en GitHub/GitLab
```

##  Comandos tiles

### Historial
```bash
# Ver commits recientes
git log --oneline -10

# Ver cambios en archivo
git log -p src/genweb.organs/content/sessio/sessio.py

# Ver qui茅n cambi贸 qu茅
git blame src/genweb.organs/content/acta/acta.py
```

### Diferencias
```bash
# Ver cambios no staged
git diff

# Ver cambios staged
git diff --cached

# Comparar con branch remoto
git diff origin/master
```

### Limpieza
```bash
# Limpiar archivos no trackeados
git clean -fd

# Reset suave (mantener cambios)
git reset --soft HEAD~1

# Reset duro (perder cambios)
git reset --hard HEAD~1
```

##  Comandos de Migraci贸n

### Backup
```bash
# Crear backup antes de migraci贸n
git tag backup-pre-migration

# Exportar base de datos
bin/instance export_content
```

### Rollback
```bash
# Volver a versi贸n anterior
git checkout backup-pre-migration

# O reset a commit espec铆fico
git reset --hard <commit-hash>
```

##  Checklist de Git

### Antes de Commit
- [ ] C贸digo funciona correctamente
- [ ] Tests pasan
- [ ] Mensaje de commit descriptivo
- [ ] No hay archivos temporales

### Antes de Push
- [ ] Rebase con master si es necesario
- [ ] Resolver conflictos
- [ ] Verificar que no se rompe nada
- [ ] Documentar cambios importantes

### Antes de Merge
- [ ] Code review completado
- [ ] Tests en CI pasan
- [ ] Documentaci贸n actualizada
- [ ] Changelog actualizado